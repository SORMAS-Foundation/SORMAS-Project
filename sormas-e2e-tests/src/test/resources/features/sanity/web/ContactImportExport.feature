@UI @Sanity @Contact @ContactImportExport
Feature: Contact import and export tests

  @tmsLink=SORDEV-10043 @env_main
  Scenario: Contact basic export test
    When API: I create a new person

    And API: I check that POST call status code is 200
    Then API: I create a new contact

    And API: I check that POST call status code is 200
    Given I log in as a Admin User
    And I click on the Contacts button from navbar
    Then I filter by Contact uuid
    And I click on the Export contact button
    Then I click on the Basic Contact Export button
    Then I check if downloaded data generated by basic contact option is correct

  @tmsLink=SORDEV-10046 @env_main
  Scenario: Contact custom export test
    When API: I create a new person

    And API: I check that POST call status code is 200
    Then API: I create a new contact

    And API: I check that POST call status code is 200
    Given I log in as a Admin User
    And I click on the Contacts button from navbar
    Then I filter by Contact uuid
    And I click on the Export contact button
    Then I click on the Custom Contact Export button
    And I click on the New Export Configuration button in Custom Contact Export popup
    Then I fill Configuration Name field with "Test Configuration" in Custom Contact Export popup
    And I select specific data to export in Export Configuration for Custom Contact Export
    When I download created custom contact export file
    And I delete created custom contact export file
    Then I check if downloaded data generated by custom contact option is correct

  @tmsLink=SORDEV-6134 @env_de
  Scenario: Test Re-add primary phone number and primary email address to import templates for Contact
    Given I log in as a Admin User
    Then I click on the Contacts button from navbar
    And I click on the More button on Contact directory page
    And I click on the Import button from Contact directory
    Then I select the "ImportContactPrio.csv" CSV file in the file picker
    And I click on the "DATENIMPORT STARTEN" button from the Import Contact popup
    Then I click to create new person from the Contact Import popup if Pick or create popup appears
    And I check that an import success notification appears in the Import Contact popup for DE
    Then I close Import Contact form
    And I filter by "UpdateTestContact ImportPrio" as a Person's full name on Contact Directory Page
    And I click APPLY BUTTON in Contact Directory Page
    And I open the last created UI Contact
    Then I open Contact Person tab
    And I check that Type of Contact details with Primary telephone as an option is visible on Edit Contact Person Page
    And I check that Type of Contact details with Primary email address as an option is visible on Edit Contact Person Page

  @tmsLink=SORDEV-9475 @env_de
  Scenario: Test Add reduced vaccination module to imports for Contacts
    Given I log in as a Admin User
    Then I click on the Contacts button from navbar
    And I click on the More button on Contact directory page
    And I click on the Import button from Contact directory
    Then I select the "Import_Contact_Vaccinations.csv" CSV file in the file picker
    And I click on the "DATENIMPORT STARTEN" button from the Import Contact popup
    Then I click to create new person from the Contact Import popup if Pick or create popup appears
    And I check that an import success notification appears in the Import Contact popup for DE
    Then I close Import Contact form
    And I filter by "Bilbo Baggins" as a Person's full name on Contact Directory Page
    And I click APPLY BUTTON in Contact Directory Page
    And I open the last created UI Contact
    And I check that number of added Vaccinations is 5 on Edit Contact Page
    And I click to edit 1 vaccination on Edit Contact page
    Then I check that displayed vaccination date is equal to "08.02.2022"
    And I check that displayed vaccination name is equal to "Sonstiges"
    And I close vaccination form in Edit Contact directory
    And I click to edit 2 vaccination on Edit Contact page
    Then I check that displayed vaccination date is equal to "07.02.2022"
    And I check that displayed vaccination name is equal to "Unbekannt"
    And I close vaccination form in Edit Contact directory
    And I click to edit 3 vaccination on Edit Contact page
    Then I check that displayed vaccination date is equal to "06.02.2022"
    And I check that displayed vaccination name is equal to "MRT5500 COVID-19 Impfstoff (Sanofi-GSK)"
    And I close vaccination form in Edit Contact directory
    And I click to edit 4 vaccination on Edit Contact page
    Then I check that displayed vaccination date is equal to "05.02.2022"
    And I check that displayed vaccination name is equal to "NVX-CoV2373 COVID-19 Impfstoff (Novavax)"
    And I close vaccination form in Edit Contact directory
    And I click to edit 5 vaccination on Edit Contact page
    Then I check that displayed vaccination date is equal to "04.02.2022"
    And I check that displayed vaccination name is equal to "Ad26.COV2.S (Johnson & Johnson)"
    And I close vaccination form in Edit Contact directory
    And I click to navigate to next page in Vaccinations tab
    And I check that number of added Vaccinations is 3 on Edit Contact Page
    And I click to edit 1 vaccination on Edit Contact page
    Then I check that displayed vaccination date is equal to "03.02.2022"
    And I check that displayed vaccination name is equal to "Vaxzevria Injektionssuspension COVID-19-Impfstoff (AstraZeneca)"
    And I close vaccination form in Edit Contact directory
    And I click to edit 2 vaccination on Edit Contact page
    Then I check that displayed vaccination date is equal to "02.02.2022"
    And I check that displayed vaccination name is equal to "COVID-19 Impfstoff Moderna (mRNA-Impfstoff)"
    And I close vaccination form in Edit Contact directory
    And I click to edit 3 vaccination on Edit Contact page
    Then I check that displayed vaccination date is equal to "01.02.2022"
    And I check that displayed vaccination name is equal to "Comirnaty (COVID-19-mRNA Impfstoff)"
    And I close vaccination form in Edit Contact directory

  @tmsLink=SORDEV-12441 @env_de
  Scenario: Hide citizenship and country of birth in Detailed Contact Export file
    When API: I create a new person

    And API: I check that POST call status code is 200
    Then API: I create a new contact

    And API: I check that POST call status code is 200
    Given I log in as a Admin User
    And I click on the Contacts button from navbar
    Then I filter by Contact uuid
    And I click on the Export contact button
    Then I click on the Detailed Contact Export button
    Then I check if citizenship and country of birth is not present in Detailed Contact export file
