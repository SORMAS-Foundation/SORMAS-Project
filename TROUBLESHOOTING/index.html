
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Troubleshooting - SORMAS Project</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bcfcd587.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#troubleshooting" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="SORMAS Project" class="md-header__button md-logo" aria-label="SORMAS Project" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SORMAS Project
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Troubleshooting
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/sormas-foundation/SORMAS-Project" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    sormas-foundation/SORMAS-Project
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="SORMAS Project" class="md-nav__button md-logo" aria-label="SORMAS Project" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    SORMAS Project
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sormas-foundation/SORMAS-Project" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    sormas-foundation/SORMAS-Project
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://sormas.org" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Official Website
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../CONTRIBUTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../DEMO_APP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demo App
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sormas-rest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../DEVELOPMENT_ENVIRONMENT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Environment
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sormas-cargoserver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cargo Server
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sormas-base/doc/keycloak/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Keycloak
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sormas-keycloak-service-provider/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Keycloak Service Provider
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../I18N/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    I18n
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SECURITY/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SERVER_CUSTOMIZATION/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customization
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SERVER_DEV_SETUP.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SERVER_SETUP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SERVER_UPDATE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SOP_DISEASES/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diseases
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADDING_LICENSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Licensing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3RD_PARTY_ACK/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgements
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#android-application-faq" class="md-nav__link">
    <span class="md-ellipsis">
      Android Application FAQ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#identify-performance-problems" class="md-nav__link">
    <span class="md-ellipsis">
      Identify Performance Problems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Identify Performance Problems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log-slow-database-queries" class="md-nav__link">
    <span class="md-ellipsis">
      Log Slow Database Queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-analysis-of-slow-database-query-sormas-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Create Analysis of Slow Database Query (SORMAS-Docker)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-slow-java-code" class="md-nav__link">
    <span class="md-ellipsis">
      Log Slow Java Code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyze-performance-problems" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze Performance Problems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analyze Performance Problems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyze-a-slow-query" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze a Slow Query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyze-java-code-performance-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze Java Code Performance Logs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ide-troubleshooting-android-studio" class="md-nav__link">
    <span class="md-ellipsis">
      IDE Troubleshooting: Android Studio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ide-troubleshooting-eclipse" class="md-nav__link">
    <span class="md-ellipsis">
      IDE Troubleshooting: eclipse
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IDE Troubleshooting: eclipse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployment-problems" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Problems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#news-feeds-polling" class="md-nav__link">
    <span class="md-ellipsis">
      News Feeds Polling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redeployment-problems" class="md-nav__link">
    <span class="md-ellipsis">
      Redeployment problems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#malware-detection-triggers" class="md-nav__link">
    <span class="md-ellipsis">
      Malware detection triggers
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="troubleshooting">Troubleshooting</h1>
<p>Please consult this collection of solutions to common problems if you have any issues before issuing a support request or asking developers for help. Also note that this resource has only been added recently and will be extended in the future. If you have encountered (and fixed) any issue that you think would be worth adding to this list, please don't hesitate to let us know!</p>
<ul>
<li><a href="#android-application-faq">Android Application FAQ</a></li>
<li><a href="#identify-performance-problems">Identify Performance Problems</a></li>
<li><a href="#log-slow-database-queries">Log Slow Database Queries</a></li>
<li><a href="#create-analysis-of-slow-database-query-sormas-docker">Create Analysis of Slow Database Query (SORMAS-Docker)</a></li>
<li><a href="#log-slow-java-code">Log Slow Java Code</a></li>
<li><a href="#analyze-performance-problems">Analyze Performance Problems</a></li>
<li><a href="#analyze-a-slow-query">Analyze a Slow Query</a></li>
<li><a href="#analyze-java-code-performance-logs">Analyze Java Code Performance Logs</a></li>
<li><a href="#ide-troubleshooting-android-studio">IDE Troubleshooting: Android Studio</a></li>
<li><a href="#ide-troubleshooting-eclipse">IDE Troubleshooting: eclipse</a></li>
<li><a href="#deployment-problems">Deployment Problems</a></li>
<li><a href="#news-feeds-polling">News Feeds Polling</a></li>
<li><a href="#redeployment-problems">Redeployment problems</a></li>
<li><a href="#malware-detection-triggers">Malware detection triggers</a></li>
</ul>
<h2 id="android-application-faq">Android Application FAQ</h2>
<p><strong>Q:</strong> I don't see a logout option anywhere in the mobile app. How can I change my user?<br />
<strong>A:</strong> The logout option is hidden by default because users in the field often don't know their own passwords, but their devices are instead set up by a supervisor. If you want to change your user, go to the Settings screen and tap the version number five times to bring up additional options, including the logout option.</p>
<p><strong>Q:</strong> The app crashes. How can I get a log file?<br />
<strong>A:</strong> If you are using a release version of the app and need to get error logs, you can do the following:  </p>
<ol>
<li><a href="https://developer.android.com/studio/debug/dev-options">Enable developer options in the Android device's settings</a></li>
<li>Use the "Take Bug Report" option. The full report is not needed.</li>
<li>The zip file that is created will have a dumpstate-<current date>.txt file that contains the log and some more information</li>
<li>Open it and search for de.symeda.sormas to identify the process ID. E.g. <code>de.symeda.sormas.app/de.symeda.sormas.app.login.LoginActivity$_11109#0</code> -&gt; 11109 is the ID</li>
<li>Search for all occurences of the process ID to filter the file down to lines that contain the actual log of sormas</li>
</ol>
<h2 id="identify-performance-problems">Identify Performance Problems</h2>
<p>There are two main sources of bad performance in the application:</p>
<ol>
<li>Slow database queries</li>
<li>Slow Java code</li>
</ol>
<h3 id="log-slow-database-queries">Log Slow Database Queries</h3>
<p>Possibly the most generally useful log setting for troubleshooting performance, especially on a production server.</p>
<p><strong>SORMAS-Docker</strong> already logs slow SQL queries by default. You can view the log output on its host VM with <code>docker logs sormas-docker_postgres_1</code>.</p>
<p>You can enable the logging of slow SQL queries in your PostgreSQL server in <code>postgresql.conf</code>:</p>
<ol>
<li>Change the value of <code>log_min_duration_statement</code> to a value that fits your need (e.g. 10000).</li>
<li>Restart the PostgreSQL service or reload the config.</li>
<li>Monitor the log file.</li>
</ol>
<h3 id="create-analysis-of-slow-database-query-sormas-docker">Create Analysis of Slow Database Query (SORMAS-Docker)</h3>
<p>You can provide an analysis of a slow running query to help the developers to see where the query is getting slow and how to fix it.</p>
<ol>
<li>
<p>Extract the slow SQL statement from slow query log.</p>
</li>
<li>
<p>Copy the SQL statement, replace all parameters (<code>$x</code>) with the values (see the following log statement) and place the SQL query on the system (outside Docker container on host):</p>
</li>
</ol>
<pre><code class="language-bash">sudo bash
cd /var/lib/docker/psqldata
vi explain.sql

# hit i (INSERT)
# Paste this into the file:  EXPLAIN (ANALYZE, COSTS, VERBOSE, BUFFERS, FORMAT JSON) 
# Paste the complete SQL statement
# Hit ESC and :wq to save the file
</code></pre>
<ol>
<li>Execute the SQL (inside Docker container):</li>
</ol>
<pre><code class="language-bash">sudo bash
docker exec -ti sormas-docker_postgres_1 bash
cd /var/lib/postgresql/data
su postgres
psql -XqAt -d sormas -f explain.sql &gt; analyze.json
</code></pre>
<ol>
<li>
<p>Copy the output to your home dir on the VM (not inside the Docker container) to be able to copy it from the VM to your local system: <code>mv analyze.json /home/user.name/</code></p>
</li>
<li>
<p>Create a visual report at <a href="https://explain.dalibo.com/">https://explain.dalibo.com/</a> in order to share the analysis. Make sure the raw query and timings are included.</p>
</li>
</ol>
<p>How to analyze this is explained below.</p>
<h3 id="log-slow-java-code">Log Slow Java Code</h3>
<p>If a specific view or action is facing bad performance it may be helpful to log the execution time of the responsible Java code.</p>
<ol>
<li>Open the logback file located in your domain (default path: <code>/opt/domains/sormas/config/logback.xml</code>) and change the log level of <code>PerformanceLoggingInterceptor</code> to <code>DEBUG</code> or <code>TRACE</code>. The config change will be recognized during runtime within 30s. After that you will see detailed log entries in the SORMAS log.</li>
<li>Reproduce the scenario you want to investigate on the server instance.</li>
<li>Set the log level back to its default once the logging has been done since it can reduce the overall performance of SORMAS.</li>
</ol>
<p><strong>Caution: Do not expose any private data!</strong> Whenever you debug problems on an instance with productive data, please make sure that the logged information does not contain any personal data like real person names, birth dates, etc. to the public. Never provide such data anywhere on GitHub or any other online tool!</p>
<p>How to analyze the log is explained below.</p>
<h2 id="analyze-performance-problems">Analyze Performance Problems</h2>
<h3 id="analyze-a-slow-query">Analyze a Slow Query</h3>
<p>To get your hands on a specific query executed by a view or action, you can do the following:</p>
<ol>
<li>Get an <a href="#create-analysis-of-slow-database-query-sormas-docker">analysis from a production system</a></li>
<li>Create your own:</li>
<li>Identify or create a unit test that calls the related backend method</li>
<li>Set the 'hibernate.show_sql' config in the persistence.xml of the test resources to true</li>
<li>Run the unit test and extract the query from the log</li>
<li>Replace any parameters in the query</li>
<li>Execute the query on your local database or a test system pre-faced by 'EXPLAIN (ANALYZE, COSTS, VERBOSE, BUFFERS, FORMAT JSON)'</li>
<li>Create a visual report at <a href="https://explain.dalibo.com/">https://explain.dalibo.com/</a> in order to share the analysis. Make sure the raw query and timings are included.</li>
</ol>
<p>Important points when <strong>interpreting the visual report</strong>:</p>
<ul>
<li>Look for the <strong>red highlights</strong> in the report, especially for nodes that have a long runtime</li>
<li>Look for nodes that are processing a <strong>lot of rows</strong> (100+ millions). This is often the case for joins</li>
<li>When you are dealing with a lof of data, most often you only need to output a subset</li>
</ul>
<p><strong>How to improve the query</strong> is most often a process of trial and error. Here are some things to consider:</p>
<ul>
<li>Adding indices so postgres does not have to go through all data. You can use a btree index to include multiple columns and sorting</li>
<li>Getting rid of unnecessary joins. Example: Joining a region of a case to compare it to the region of the user, instead of directly doing this on the region_id field of the case</li>
<li>Using limit to reduce the output (e.g. the first 100). Make sure there is no sorting done close to the end of the query graph. This is often the case when 'DISTINCT' is used.
<a href="https://github.com/sormas-foundation/SORMAS-Project/issues/9054#issuecomment-1420849461">See Example</a></li>
<li>Splitting the query into separate queries when 'DISTINCT' has to be used / using distinct on a sub-query</li>
<li>Using sub-queries to influence the query planner.
<a href="https://github.com/sormas-foundation/SORMAS-Project/issues/11465#issuecomment-1425789509">See Example</a></li>
</ul>
<p><strong>How to save time</strong> when optimizing the query:</p>
<ul>
<li>Make sure you have easy access to a database that allows you to reproduce the bad performance of the query and to <strong>manipulate the query and re-run it directly on the database</strong>.</li>
<li>Use the explain feature of pgAdmin to quickly output the query graph for debugging purposes</li>
<li>Make sure you have a unit test (see above) that allows you to create the SQL query from a criteria query without having to re-deploy your server</li>
</ul>
<h3 id="analyze-java-code-performance-logs">Analyze Java Code Performance Logs</h3>
<p>After <a href="#log-slow-java-code">Logging Slow Java Code</a> the debug log file (default path: <code>/opt/domains/sormas/logs/application.debug</code>) can be analyzed in detail using the <code>PerformanceLogAnalysisGenerator</code>.</p>
<p>The log file's path is specified as the program argument when calling <code>PerformanceLogAnalysisGenerator</code>'s <code>main</code> method. Processing the log file will
generate three files (<code>&lt;logfileName&gt;.csv</code>, <code>&lt;logfileName&gt;.txt</code>, <code>&lt;logfileName&gt;.html</code>) to further investigate method runtimes.</p>
<p><code>&lt;logfileName&gt;.html</code> provides a navigable overview of methods along with runtime statistics (total, min, max and average time) and calls to sub methods.</p>
<p>Sometimes it is convenient to analyze a number of different scenarios in a row. To do so, produce snippets of the <code>application.debug</code> log using <code>tail</code> for each
of the scenarios to be investigated:</p>
<ol>
<li>start <code>tail -f &lt;logfileName&gt; &gt; &lt;snippetDirectory&gt;/&lt;snippet.debug&gt;</code></li>
<li>replay the steps to be analyzed</li>
<li>stop <code>tail -f</code></li>
</ol>
<p>The <code>PerformanceLogAnalysisGenerator</code> can now batch process all of the snippets by pointing to the directory instead of a log file.
Calling <code>PerformanceLogAnalysisGenerator.main</code> with argument <code>&lt;snippetDirectory&gt;</code> generates the analysis files (<code>.csv</code>, <code>.txt</code>, <code>.html</code>)
for each file <code>*.debug</code> in this directory. The generated files will be placed in <code>&lt;snippetDirectory&gt;</code>, too.</p>
<h2 id="ide-troubleshooting-android-studio">IDE Troubleshooting: Android Studio</h2>
<p>If for some reason the Android App is not building correctly (for example due to unexpected <code>ClassNotFoundExceptions</code>), here is what you should try:
- Clean the Project (Build -&gt; Clean Project)
- Invalidate Caches (File -&gt; Invalidate Caches / Restart...)
- Wipe your Android VM (AVD Manager -&gt; Wipe Data)</p>
<p>If you get this exception: <code>Unable to load class 'javax.xml.bind.JAXBException'</code>, the reason is most likely a faulty JDK version. For the androidapp, you need Java JDK 8. To change the JDK, go to File -&gt; Project Structure -&gt; JDK Location and select a valid JDK (on Linux, check the folder <code>/usr/lib/jvm</code> and/or install if necessary: <code>sudo apt install openjdk-8-jdk</code>)</p>
<h2 id="ide-troubleshooting-eclipse">IDE Troubleshooting: eclipse</h2>
<h3 id="deployment-problems">Deployment Problems</h3>
<p>Unfortunately, when using eclipse together with the Payara Tools, there are a number of deployment problems that you might run into. Examples of these include:</p>
<ul>
<li>ClassDefNotFoundExceptions after deploying the artifacts and logging in to the web app</li>
<li>Error messages in eclipse telling you that the deployment failed</li>
</ul>
<p>There are a couple of things you can do to fix these problems:</p>
<ul>
<li>Do a Maven update for all projects</li>
<li>Stop and restart the server</li>
<li>Re-deploy the server artifacts</li>
</ul>
<p>If the problem occurred right after you've pulled new code from GitHub, your safest bet is probably to start with the Maven update. For most other problems, a simple re-deployment or, if necessary, server restart should suffice.</p>
<h3 id="news-feeds-polling">News Feeds Polling</h3>
<p>When running eclipse with JDK 11, you might encounter the following error message: <code>An internal error occurred during: "Polling news feeds".  javax/xml/bind/JAXBContext</code>. To fix it, disable <code>Window --&gt; Preferences --&gt; General --&gt; News --&gt; "Enable automatic news polling"</code>.</p>
<h2 id="redeployment-problems">Redeployment problems</h2>
<p>If you face problems that <code>sormas-ui</code> or <code>sormas-rest</code> cannot call the backend anymore after redeploying, please follow <a href="../DEVELOPMENT_ENVIRONMENT/#avoid-redeployment-problems">this instruction</a>.</p>
<h2 id="malware-detection-triggers">Malware detection triggers</h2>
<p>It might happen that a defensive program on your system falsely recognizes files needed to run SORMAS as vulnerability.</p>
<p>Please ignore the following known findings (no quarantine, no deletion):
* File: payara-5.2021.10.zip, Recognized: Trojan:Script/Oneeva.A!ml (found by Windows Defender). Has rarely happened when running server-setup.sh which downloads that file. The script subsequently fails because zip file cannot be extracted.
* File: glassfish/modules/war-util.jar, Recognized: Exploit:Java/CVE-2012-0507.D!ldr (found by Windows Defender in payara-5.2021.10). The deployed OSGi bundle might also be recognized, for example under this path: osgi-cache/felix/bundle365/version0.0/bundle.jar . If the file is quarantined, the paraya domain fails to start, without any exception in the log.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/sormas-foundation/SORMAS-Project" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["tabs"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": 0.1}</script>
    
    
      <script src="../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>