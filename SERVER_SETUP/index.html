
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../SERVER_CUSTOMIZATION/">
      
      
        <link rel="next" href="../SERVER_UPDATE/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Setup - SORMAS Project</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bcfcd587.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#installing-a-sormas-server" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="SORMAS Project" class="md-header__button md-logo" aria-label="SORMAS Project" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SORMAS Project
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Setup
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/sormas-foundation/SORMAS-Project" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    sormas-foundation/SORMAS-Project
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="SORMAS Project" class="md-nav__button md-logo" aria-label="SORMAS Project" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    SORMAS Project
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sormas-foundation/SORMAS-Project" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    sormas-foundation/SORMAS-Project
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://sormas.org" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Official Website
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../CONTRIBUTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../DEMO_APP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demo App
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sormas-rest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../DEVELOPMENT_ENVIRONMENT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Environment
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sormas-cargoserver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cargo Server
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sormas-base/doc/keycloak/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Keycloak
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sormas-keycloak-service-provider/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Keycloak Service Provider
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../I18N/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    I18n
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SECURITY/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SERVER_CUSTOMIZATION/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customization
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SERVER_DEV_SETUP.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Setup
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Setup
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#content" class="md-nav__link">
    <span class="md-ellipsis">
      Content
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related" class="md-nav__link">
    <span class="md-ellipsis">
      Related
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#java-11" class="md-nav__link">
    <span class="md-ellipsis">
      Java 11
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Java 11">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      Linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      Windows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgres-database" class="md-nav__link">
    <span class="md-ellipsis">
      Postgres Database
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sormas-server" class="md-nav__link">
    <span class="md-ellipsis">
      SORMAS Server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SORMAS Server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-on-linux" class="md-nav__link">
    <span class="md-ellipsis">
      Install on Linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Install on Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auditing" class="md-nav__link">
    <span class="md-ellipsis">
      Auditing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sormas-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Sormas installation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keycloak-server" class="md-nav__link">
    <span class="md-ellipsis">
      Keycloak Server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Keycloak Server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#keycloak-as-a-docker-container" class="md-nav__link">
    <span class="md-ellipsis">
      Keycloak as a Docker container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keycloak-as-a-standalone-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Keycloak as a standalone installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connect-keycloak-to-an-already-running-instance-of-sormas" class="md-nav__link">
    <span class="md-ellipsis">
      Connect Keycloak to an already running instance of SORMAS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronization-between-sormas-and-keycloak" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronization between SORMAS and Keycloak
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keycloak-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Keycloak configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-server-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Web Server Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Web Server Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apache-web-server" class="md-nav__link">
    <span class="md-ellipsis">
      Apache Web Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    <span class="md-ellipsis">
      Firewall
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postfix-mail-server" class="md-nav__link">
    <span class="md-ellipsis">
      Postfix Mail Server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Postfix Mail Server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-postfix-and-mailutils" class="md-nav__link">
    <span class="md-ellipsis">
      Install postfix and mailutils
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-your-system" class="md-nav__link">
    <span class="md-ellipsis">
      Configure your system
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-server-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the Server Setup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#r-software-environment" class="md-nav__link">
    <span class="md-ellipsis">
      R Software Environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sormas-to-sormas-certificate-setup" class="md-nav__link">
    <span class="md-ellipsis">
      SORMAS to SORMAS Certificate Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-login-fails" class="md-nav__link">
    <span class="md-ellipsis">
      Problem: Login fails
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-server-is-out-of-memory" class="md-nav__link">
    <span class="md-ellipsis">
      Problem: Server is out of memory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SERVER_UPDATE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SOP_DISEASES/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diseases
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADDING_LICENSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Licensing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3RD_PARTY_ACK/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgements
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#content" class="md-nav__link">
    <span class="md-ellipsis">
      Content
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related" class="md-nav__link">
    <span class="md-ellipsis">
      Related
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#java-11" class="md-nav__link">
    <span class="md-ellipsis">
      Java 11
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Java 11">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      Linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      Windows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgres-database" class="md-nav__link">
    <span class="md-ellipsis">
      Postgres Database
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sormas-server" class="md-nav__link">
    <span class="md-ellipsis">
      SORMAS Server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SORMAS Server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-on-linux" class="md-nav__link">
    <span class="md-ellipsis">
      Install on Linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Install on Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auditing" class="md-nav__link">
    <span class="md-ellipsis">
      Auditing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sormas-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Sormas installation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keycloak-server" class="md-nav__link">
    <span class="md-ellipsis">
      Keycloak Server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Keycloak Server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#keycloak-as-a-docker-container" class="md-nav__link">
    <span class="md-ellipsis">
      Keycloak as a Docker container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keycloak-as-a-standalone-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Keycloak as a standalone installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connect-keycloak-to-an-already-running-instance-of-sormas" class="md-nav__link">
    <span class="md-ellipsis">
      Connect Keycloak to an already running instance of SORMAS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronization-between-sormas-and-keycloak" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronization between SORMAS and Keycloak
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keycloak-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Keycloak configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-server-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Web Server Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Web Server Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apache-web-server" class="md-nav__link">
    <span class="md-ellipsis">
      Apache Web Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    <span class="md-ellipsis">
      Firewall
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postfix-mail-server" class="md-nav__link">
    <span class="md-ellipsis">
      Postfix Mail Server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Postfix Mail Server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-postfix-and-mailutils" class="md-nav__link">
    <span class="md-ellipsis">
      Install postfix and mailutils
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-your-system" class="md-nav__link">
    <span class="md-ellipsis">
      Configure your system
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-server-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the Server Setup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#r-software-environment" class="md-nav__link">
    <span class="md-ellipsis">
      R Software Environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sormas-to-sormas-certificate-setup" class="md-nav__link">
    <span class="md-ellipsis">
      SORMAS to SORMAS Certificate Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-login-fails" class="md-nav__link">
    <span class="md-ellipsis">
      Problem: Login fails
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-server-is-out-of-memory" class="md-nav__link">
    <span class="md-ellipsis">
      Problem: Server is out of memory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="installing-a-sormas-server">Installing a SORMAS Server</h1>
<p><strong>Note: This guide explains how to set up a SORMAS server on Linux and Windows systems, the latter only being intended for usage on development systems. Please also note that certain parts of the setup script will not be executed on Windows.</strong></p>
<h2 id="content">Content</h2>
<ul>
<li><a href="#installing-a-sormas-server">Installing a SORMAS Server</a></li>
<li><a href="#content">Content</a></li>
<li><a href="#related">Related</a></li>
<li><a href="#prerequisites">Prerequisites</a><ul>
<li><a href="#java-11">Java 11</a></li>
<li><a href="#linux">Linux</a></li>
<li><a href="#windows">Windows</a></li>
<li><a href="#postgres-database">Postgres Database</a></li>
</ul>
</li>
<li><a href="#sormas-server">SORMAS Server</a><ul>
<li><a href="#install-on-linux">Install on Linux</a></li>
<li><a href="#install-on-windows">Install on Windows</a></li>
<li><a href="#auditing">Auditing</a></li>
<li><a href="#sormas-installation">Sormas installation</a></li>
</ul>
</li>
<li><a href="#keycloak-server">Keycloak Server</a><ul>
<li><a href="#keycloak-as-a-docker-container">Keycloak as a Docker container</a></li>
<li><a href="#keycloak-as-a-standalone-installation">Keycloak as a standalone installation</a></li>
<li><a href="#connect-keycloak-to-an-already-running-instance-of-sormas">Connect Keycloak to an already running instance of SORMAS</a></li>
<li><a href="#keycloak-configuration">Keycloak configuration</a></li>
</ul>
</li>
<li><a href="#web-server-setup">Web Server Setup</a><ul>
<li><a href="#apache-web-server">Apache Web Server</a></li>
<li><a href="#firewall">Firewall</a></li>
<li><a href="#postfix-mail-server">Postfix Mail Server</a></li>
<li><a href="#install-postfix-and-mailutils">Install postfix and mailutils</a></li>
<li><a href="#configure-your-system">Configure your system</a></li>
<li><a href="#testing-the-server-setup">Testing the Server Setup</a></li>
</ul>
</li>
<li><a href="#r-software-environment">R Software Environment</a></li>
<li><a href="#sormas-to-sormas-certificate-setup">SORMAS to SORMAS Certificate Setup</a></li>
<li><a href="#troubleshooting">Troubleshooting</a><ul>
<li><a href="#problem-login-fails">Problem: Login fails</a></li>
<li><a href="#problem-server-is-out-of-memory">Problem: Server is out of memory</a></li>
</ul>
</li>
</ul>
<h2 id="related">Related</h2>
<ul>
<li><a href="../DEMO_APP/">Creating an App for a Demo Server</a></li>
<li><a href="https://github.com/sormas-foundation/SORMAS-Docker">SORMAS Docker Repository</a></li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<h3 id="java-11">Java 11</h3>
<p>Download and install the Java 11 <strong>JDK</strong> (not JRE) for your operating system. We suggest using the <a href="https://www.azul.com/downloads/zulu/">Zulu OpenJDK</a>.</p>
<h4 id="linux"><a href="https://docs.azul.com/zulu/zuludocs/#ZuluUserGuide/PrepareZuluPlatform/AttachAPTRepositoryUbuntuOrDebianSys.htm">Linux</a></h4>
<pre><code class="language-bash">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 0xB1998361219BD9C9
sudo apt-add-repository 'deb https://repos.azul.com/zulu/deb/ stable main'
sudo apt-get update
sudo apt-get install zulu11
</code></pre>
<h4 id="windows">Windows</h4>
<p>For testing and development environments we suggest to download and run the installer of the Java 11 <strong>JDK</strong> for 32 or 64 bit client systems (depending on your system).
You can check your Java version from the shell/command-line using: <code>java -version</code>.</p>
<h3 id="postgres-database">Postgres Database</h3>
<ul>
<li>Install PostgreSQL (currently 14 to 15) on your system (manuals for all OS can be found here: <a href="https://www.postgresql.org/download">https://www.postgresql.org/download</a>)</li>
<li>Set <strong>max_connections = 288</strong> and <strong>max_prepared_transactions = 256</strong> (at least, sum of all connection pools) in <code>postgresql.conf</code> (e.g. <code>/etc/postgresql/14.0/main/postgresql.conf</code>; <code>C:/Program Files/PostgreSQL/14.0/data</code>) - make sure the property is uncommented and restart the service to apply the changes.</li>
<li>Install the "temporal tables" extension for Postgres (<a href="https://github.com/arkhipov/temporal_tables">https://github.com/arkhipov/temporal_tables</a>)</li>
<li><strong>Windows</strong>: Download the latest version for your Postgres version:<ul>
<li><a href="https://github.com/arkhipov/temporal_tables/releases/latest">https://github.com/arkhipov/temporal_tables/releases/latest</a>, then copy the DLL from the project into the PostgreSQL's lib directory and the .sql and .control files into the directory share\extension.</li>
</ul>
</li>
<li><strong>Linux</strong> (see <a href="https://github.com/arkhipov/temporal_tables#installation)">https://github.com/arkhipov/temporal_tables#installation)</a>
    <code>bash
    sudo apt-get install libpq-dev
    sudo apt-get install postgresql-server-dev-all
    sudo apt install pgxnclient
    #Check for GCC:
    gcc --version # and install if missing
    sudo pgxn install temporal_tables
    # The packages can be removed afterward</code><ul>
<li>Add the PostgreSQL path (/etc/PostgreSQL/10/bin) to Environment Variables</li>
</ul>
</li>
</ul>
<h2 id="sormas-server">SORMAS Server</h2>
<p>Get the latest SORMAS build by downloading the ZIP archive from the latest release on GitHub: <a href="https://github.com/sormas-foundation/SORMAS-Project/releases/latest">https://github.com/sormas-foundation/SORMAS-Project/releases/latest</a></p>
<h3 id="install-on-linux">Install on Linux</h3>
<p>Unzip the archive, copy/upload its contents to <strong>/root/deploy/sormas/$(date +%F)</strong> and make the setup script executable (as root user).</p>
<pre><code class="language-bash">sudo su
mkdir -p /root/deploy/sormas
cd /root/deploy/sormas
SORMAS_VERSION=1.y.z
wget https://github.com/sormas-foundation/SORMAS-Project/releases/download/v${SORMAS_VERSION}/sormas_${SORMAS_VERSION}.zip
unzip sormas_${SORMAS_VERSION}.zip
mv deploy/ $(date +%F)
rm sormas_${SORMAS_VERSION}.zip
chmod +x $(date +%F)/server-setup.sh
</code></pre>
<h3 id="install-on-windows">Install on Windows</h3>
<ul>
<li>Download &amp; install Git for Windows. This will provide a bash emulation that you can use to run the setup script: <a href="https://gitforwindows.org/">https://gitforwindows.org/</a></li>
<li>Unzip the ZIP archive (e.g. into you download directory)</li>
<li>Open Git Bash and navigate to the setup sub-directory</li>
</ul>
<h3 id="auditing">Auditing</h3>
<p>You can configure the audit logger of SORMAS by providing a Logback <a href="https://logback.qos.ch/manual/configuration.html">configuration file</a> and setting the <code>audit.logger.config</code> property accordingly. An example is provided in <code>sormas-base/setup/audit-logback.xml</code>.  Not specifying a value for the property will effectively disable the audit log.</p>
<h3 id="sormas-installation">Sormas installation</h3>
<ul>
<li>Optional: Open <code>server-setup.sh</code> in a text editor to customize the install paths, database access and ports for the server. The default ports are 6080 (HTTP), 6081 (HTTPS) and 6048 (admin). <strong>Important:</strong> Do not change the name of the database user. The predefined name is used in the statements executed in the database.</li>
<li>Set up the database and a Payara domain for SORMAS by executing the setup script: <code>sudo -s ./server-setup.sh</code> Press enter whenever asked for it</li>
<li><strong>IMPORTANT</strong>: Make sure the script executed successfully. If anything goes wrong you need to fix the problem (or ask for help), then delete the created domain directory and re-execute the script.</li>
<li><strong>IMPORTANT</strong>: Adjust the SORMAS configuration for your country in /opt/domains/sormas/sormas.properties</li>
<li>Adjust the logging configuration in <code>/opt/domains/sormas/config/logback.xml</code> based on your needs (e.g. configure and activate email appender)</li>
<li>Linux: <a href="../SERVER_UPDATE/">Update the SORMAS domain</a></li>
</ul>
<h2 id="keycloak-server">Keycloak Server</h2>
<p><strong>Note</strong>: SORMAS also comes with a basic auth mechanism using an JEE authentication realm. This authentication mechanism should only be used for development environments. For <strong>production environments always use the keycloak authentication mechansim.</strong> See <a href="https://github.com/sormas-foundation/SORMAS-Project/wiki/Authentication-&amp;-Authorization">Authentication &amp; Authorization</a>.</p>
<p>Keycloak can be set up in two ways:
* as a Docker container (for just using Keycloak approach)
* as a Standalone installation (for doing development in Keycloak like themes, SPIs)</p>
<h3 id="keycloak-as-a-docker-container">Keycloak as a Docker container</h3>
<p><em>To be done only in the situation when SORMAS is already installed on the machine as a standalone installation.</em></p>
<p><em>For complete Docker setup see the <a href="https://github.com/sormas-foundation/SORMAS-Docker/tree/keycloak-integration">SORMAS-Docker</a> repository.</em></p>
<p><strong>Prerequisites</strong>
* SORMAS Server is installed
* PostgreSQL is installed
* Docker is installed
* Open and edit <code>sormas-base/setup/keycloak/keycloak-setup.sh</code> with your system's actual values <em>(on Windows use Git Bash)</em>.</p>
<p><strong>Setup</strong>
* Run <code>sormas-base/setup/keycloak/keycloak-setup.sh</code>
* Update <code>sormas.properties</code> file in the SORMAS domain with the property <code>authentication.provider=KEYCLOAK</code>
* Change in keycloak administration console the client ID for <code>sormas-stats</code> and <code>sormas-ui</code> from <code>https</code> to <code>http</code></p>
<h3 id="keycloak-as-a-standalone-installation">Keycloak as a standalone installation</h3>
<p><strong>Prerequisites</strong>
* SORMAS Server is installed
* PostgreSQL is installed</p>
<p><strong>Setup</strong></p>
<p>Setting Keycloak up as a standalone installation as described in the <a href="https://www.keycloak.org/guides">Getting started</a> section of the official guide
* Make sure to configure Keycloak with PostgreSQL <a href="https://www.keycloak.org/server/db">Database</a>
* Set up an <a href="https://www.keycloak.org/docs/latest/server_admin/#creating-the-account-remotely">Admin User</a>
* Copy the <code>themes</code> folder content to <code>${KEYCLOAK_HOME}/themes</code> as described <a href="https://www.keycloak.org/docs/18.0/server_development/#_themes">here</a>
* Deploy the <code>sormas-keycloak-service-provider</code> as described <a href="https://www.keycloak.org/docs/18.0/server_development/#_providers">here</a>
* Update the <code>sormas-base/setup/keycloak/SORMAS.json</code> file by replacing the following placeholders: <code>${SORMAS_SERVER_URL}</code>, <code>${KEYCLOAK_SORMAS_UI_SECRET}</code>, <code>${KEYCLOAK_SORMAS_BACKEND_SECRET}</code>, <code>${KEYCLOAK_SORMAS_REST_SECRET}</code>
* Create the SORMAS Realm by importing <code>sormas-base/setup/keycloak/SORMAS.json</code> see <a href="https://www.keycloak.org/docs/18.0/server_admin/#proc-creating-a-realm_server_administration_guide">Create a New Realm</a>
* Update the <code>sormas-*</code> clients by generating new secrets for them
* Update the realm's email settings to allow sending emails to users</p>
<p>To update the SORMAS Server run the following commands:</p>
<pre><code class="language-bash">${ASADMIN} set-config-property --propertyName=payara.security.openid.clientSecret --propertyValue=${KEYCLOAK_SORMAS_UI_SECRET} --source=domain
${ASADMIN} set-config-property --propertyName=payara.security.openid.clientId --propertyValue=sormas-ui --source=domain
${ASADMIN} set-config-property --propertyName=payara.security.openid.scope --propertyValue=openid --source=domain
${ASADMIN} set-config-property --propertyName=payara.security.openid.providerURI --propertyValue=http://localhost:${KEYCLOAK_PORT}/keycloak/auth/realms/SORMAS --source=domain
${ASADMIN} set-config-property --propertyName=sormas.rest.security.oidc.json \
        --propertyValue=&quot;{\&quot;realm\&quot;:\&quot;SORMAS\&quot;,\&quot;auth-server-url\&quot;:\&quot;http://localhost:${KEYCLOAK_PORT}/auth\&quot;,\&quot;ssl-required\&quot;:\&quot;external\&quot;,\&quot;resource\&quot;:\&quot;sormas-rest\&quot;,\&quot;credentials\&quot;:{\&quot;secret\&quot;:\&quot;${KEYCLOAK_SORMAS_REST_SECRET}\&quot;},\&quot;confidential-port\&quot;:0,\&quot;principal-attribute\&quot;:\&quot;preferred_username\&quot;,\&quot;enable-basic-auth\&quot;:true}&quot; \
        --source=domain
${ASADMIN} set-config-property --propertyName=sormas.backend.security.oidc.json --propertyValue=&quot;{\&quot;realm\&quot;:\&quot;SORMAS\&quot;,\&quot;auth-server-url\&quot;:\&quot;http://localhost:${KEYCLOAK_PORT}/auth/\&quot;,\&quot;ssl-required\&quot;:\&quot;external\&quot;,\&quot;resource\&quot;:\&quot;sormas-backend\&quot;,\&quot;credentials\&quot;:{\&quot;secret\&quot;:\&quot;${KEYCLOAK_SORMAS_BACKEND_SECRET}\&quot;},\&quot;confidential-port\&quot;:0}&quot; --source=domain
</code></pre>
<p>where:
* <code>${ASADMIN}</code> - represents the location to <code>${PAYARA_HOME}\bin\asadmin</code>
* <code>${KEYCLOAK_PORT}</code> - the port on which keycloak will run
* <code>${KEYCLOAK_SORMAS_UI_SECRET}</code> - is the secret generated in Keycloak for the <code>sormas-ui</code> client
* <code>${KEYCLOAK_SORMAS_REST_SECRET}</code> - is the secret generated in Keycloak for the <code>sormas-rest</code> client
* <code>${KEYCLOAK_SORMAS_BACKEND_SECRET}</code> - is the secret generated in Keycloak for the <code>sormas-backend</code> client</p>
<p>Then update <code>sormas.properties</code> file in the SORMAS domain with the property <code>authentication.provider=KEYCLOAK</code></p>
<h3 id="connect-keycloak-to-an-already-running-instance-of-sormas">Connect Keycloak to an already running instance of SORMAS</h3>
<p><em>after setting up Keycloak as one of the described options above</em></p>
<p>In case Keycloak is set up alongside an already running instance of SORMAS, these are the steps to follow to make sure already existing users can access the system:
1. Manually create an admin user in Keycloak for the SORMAS realm <a href="https://www.keycloak.org/docs/18.0/server_admin/#proc-creating-user_server_administration_guide">Creating a user</a> <em>(username has to be the same as admin's username in SORMAS)</em>
2. If your server is not using SSL (e.g. because it's a development environment), you need to update the Root URL of the sormas-ui client in the SORMAS realm to use http instead of https
3. Login to SORMAS and trigger the <strong>Sync Users</strong> button from the <strong>Users</strong> page
4. This will sync users to Keycloak keeping their original password - see <a href="../sormas-keycloak-service-provider/">SORMAS Keycloak Service Provider</a> for more information about this</p>
<h3 id="synchronization-between-sormas-and-keycloak">Synchronization between SORMAS and Keycloak</h3>
<p>The synchronization of users between SORMAS and Keycloak is can be done in two ways:
from SORMAS to Keycloak or from Keycloak to SORMAS depending on how the <code>AUTH_PROVIDER_TO_SORMAS_USER_SYNC</code> feature is configured.</p>
<p>By default, the <code>AUTH_PROVIDER_TO_SORMAS_USER_SYNC</code> feature is disabled so the synchronization happens from SORMAS to Keycloak.
An automatic synchronization happens when a user is created/changed/deleted in SORMAS, 
and there is another way to trigger this manually by an admin on the users page meaning the users are managed in SORMAS.</p>
<p>If the feature is enabled, the synchronization is done from Keycloak to SORMAS.
In order to make this feature work you also need to configure the <code>authentication.provider.syncedNewUserRole</code>configuration property in the <code>sormas.properties</code> file 
to the name of the role that you want to be assigned to the new users coming from Keycloak.</p>
<p>This feature doesn't allow changing the users in SORMAS, except their roles and language, so users will be managed in keycloak.
The synchronization is done automatically each day at night, or manually by an admin on the users page when needed.</p>
<h3 id="keycloak-configuration">Keycloak configuration</h3>
<p>More about the default configuration and how to customize can be found here <a href="../sormas-base/doc/keycloak.md">Keycloak</a></p>
<h2 id="web-server-setup">Web Server Setup</h2>
<h3 id="apache-web-server">Apache Web Server</h3>
<p><strong>Note: This is not necessary for development systems.</strong> When you are using SORMAS in a production environment you should use a http server like Apache 2 instead of putting the Payara server in the first line.
Here are some things that you should do to configure the Apache server as a proxy:</p>
<p>Activate all needed modules:</p>
<pre><code class="language-bash">a2enmod ssl
a2enmod rewrite
a2enmod proxy
a2enmod proxy_http
a2enmod headers
</code></pre>
<p>Create a new site <code>/etc/apache2/sites-available/your.sormas.server.url.conf</code> (e.g. sormas.org.conf).</p>
<p>Force SSL secured connections: redirect from http to https:</p>
<pre><code class="language-xml">&lt;VirtualHost *:80&gt;
        ServerName your.sormas.server.url
        RewriteEngine On
        RewriteCond %{HTTPS} !=on
        RewriteRule ^/(.*) https://your.sormas.server.url/$1 [R,L]
&lt;/VirtualHost&gt;
&lt;IfModule mod_ssl.c&gt;
&lt;VirtualHost *:443&gt;
        ServerName your.sormas.server.url
        ...
&lt;/VirtualHost&gt;
&lt;/IfModule&gt;
</code></pre>
<p>Configure logging:</p>
<pre><code class="language-text">ErrorLog /var/log/apache2/error.log
LogLevel warn
LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b _%D_ \&quot;%{User}i\&quot;  \&quot;%{Connection}i\&quot;  \&quot;%{Referer}i\&quot; \&quot;%{User-agent}i\&quot;&quot; combined_ext
CustomLog /var/log/apache2/access.log combined_ext
</code></pre>
<p>SSL key config:</p>
<pre><code class="language-text">SSLEngine on
SSLCertificateFile    /etc/ssl/certs/your.sormas.server.url.crt
SSLCertificateKeyFile /etc/ssl/private/your.sormas.server.url.key
SSLCertificateChainFile /etc/ssl/certs/your.sormas.server.url.ca-bundle

# disable weak ciphers and old TLS/SSL
SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE$
SSLHonorCipherOrder off
</code></pre>
<p>Add a proxy pass to the local port:</p>
<pre><code class="language-text">ProxyRequests Off
ProxyPass /sormas-ui http://localhost:6080/sormas-ui
ProxyPassReverse /sormas-ui http://localhost:6080/sormas-ui
ProxyPass /sormas-rest http://localhost:6080/sormas-rest
ProxyPassReverse /sormas-rest http://localhost:6080/sormas-rest
</code></pre>
<p>Configure security settings:</p>
<pre><code class="language-text">Header always set X-Content-Type-Options &quot;nosniff&quot;
Header always set X-Xss-Protection &quot;1; mode=block&quot;
# Disable Caching
Header always set Cache-Control &quot;no-cache, no-store, must-revalidate, private&quot;
Header always set Pragma &quot;no-cache&quot;

Header always set Content-Security-Policy \
        &quot;default-src 'none'; \
        object-src 'self'; \
        script-src 'self' 'unsafe-inline' 'unsafe-eval'; \
        connect-src https://fonts.googleapis.com https://fonts.gstatic.com 'self'; \
        img-src *; \
        style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; \
        font-src https://fonts.gstatic.com 'self'; \
        frame-src 'self'; \
        worker-src 'self'; \
        manifest-src 'self'; \
        frame-ancestors 'self'

# The Content-Type header was either missing or empty.
# Ensure each page is setting the specific and appropriate content-type value for the content being delivered.
AddType application/vnd.ms-fontobject    .eot
AddType application/x-font-opentype      .otf
AddType image/svg+xml                    .svg
AddType application/x-font-ttf           .ttf
AddType application/font-woff            .woff
</code></pre>
<p>Activate output compression (very important!):</p>
<pre><code class="language-xml">&lt;IfModule mod_deflate.c&gt;
        AddOutputFilterByType DEFLATE text/plain text/html text/xml
        AddOutputFilterByType DEFLATE text/css text/javascript
        AddOutputFilterByType DEFLATE application/json
        AddOutputFilterByType DEFLATE application/xml application/xhtml+xml
        AddOutputFilterByType DEFLATE application/javascript application/x-javascript
        DeflateCompressionLevel 1
&lt;/IfModule&gt;
</code></pre>
<p>Provide the Android apk:</p>
<pre><code class="language-java">Options -Indexes
AliasMatch &quot;/downloads/sormas-(.*)&quot; &quot;/var/www/sormas/downloads/sormas-$1&quot;
</code></pre>
<p>For the Apache 2 security configuration we suggest the following settings (<code>/etc/apache2/conf-available/security.conf</code>):</p>
<pre><code class="language-conf">ServerTokens Prod
ServerSignature Off
TraceEnable Off

Header always set Strict-Transport-Security &quot;max-age=15768000; includeSubDomains; preload&quot;
Header unset X-Frame-Options
Header always set X-Frame-Options SAMEORIGIN
Header unset Referrer-Policy
Header always set Referrer-Policy &quot;same-origin&quot;
Header edit Set-Cookie &quot;(?i)^((?:(?!;\s?HttpOnly).)+)$&quot; &quot;$1;HttpOnly&quot;
Header edit Set-Cookie &quot;(?i)^((?:(?!;\s?Secure).)+)$&quot; &quot;$1;Secure&quot;

Header unset X-Powered-By
Header unset Server
</code></pre>
<ul>
<li>In case you need to update the site config while the server is running, use the following command to publish the changes without the need for a reload:</li>
</ul>
<pre><code class="language-bash">apache2ctl graceful
</code></pre>
<h3 id="firewall">Firewall</h3>
<ul>
<li>The server should only publish the ports that are needed. For SORMAS this is port 80 (HTTP) and 443 (HTTPS). In addition you will need the SSH port to access the server for admin purposes.</li>
<li>We suggest to use UFW (Uncomplicated Firewall) which provides a simple interface to iptables:</li>
</ul>
<pre><code class="language-bash">sudo apt-get install ufw
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
sudo ufw enable
</code></pre>
<h3 id="postfix-mail-server">Postfix Mail Server</h3>
<h4 id="install-postfix-and-mailutils">Install postfix and mailutils</h4>
<pre><code class="language-bash">apt install aptitude
aptitude install postfix
-&gt; choose &quot;satelite system&quot;
apt install mailutils
</code></pre>
<h4 id="configure-your-system">Configure your system</h4>
<pre><code class="language-bash">nano /etc/aliases
-&gt; add &quot;root: enter-your@support-email-here.com&quot;
nano /opt/domains/sormas/config/logback.xml
-&gt; make sure &quot;EMAIL_ERROR&quot; appender is active and sends out to your email address
</code></pre>
<h3 id="testing-the-server-setup">Testing the Server Setup</h3>
<p>Use SSL Labs to test your server security config: <a href="https://www.ssllabs.com/ssltest">https://www.ssllabs.com/ssltest</a></p>
<h2 id="r-software-environment">R Software Environment</h2>
<p>In order to enable disease network diagrams in the contact dashboard, R and several extension packages are required.
Then the Rscript executable has to be configured in the <code>sormas.properties</code> file.
This can be conveniently accomplished by executing the R setup script from the SORMAS ZIP archive (see <a href="#sormas-server">SORMAS Server</a>):</p>
<ul>
<li>If the SORMAS installation has been customized, <code>r-setup.sh</code> the install paths may have to be adjusted accordingly with a text editor.</li>
<li>Execute R setup script and follow its instructions.</li>
</ul>
<pre><code class="language-bash">chmod +x r-setup.sh
./r-setup.sh
</code></pre>
<h2 id="sormas-to-sormas-certificate-setup">SORMAS to SORMAS Certificate Setup</h2>
<p>To be able to communicate with other SORMAS instances, there are some additional steps which need to be taken, in order to set
up the certificate and the truststore. Please see the <a href="https://github.com/sormas-foundation/SORMAS-Project/wiki/Creating-a-SORMAS2SORMAS-Certificate">related guide</a> for detailed instructions regarding SORMAS to SORMAS setup.
<br/></p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="problem-login-fails">Problem: Login fails</h3>
<p>Check that the users table does have a corresponding entry. If not, the database initialization that is done when deploying sormas-ear.ear probably had an error.</p>
<h3 id="problem-server-is-out-of-memory">Problem: Server is out of memory</h3>
<p>Old servers were set up with a memory size of less than 2048MB. You can change this using the following commands:</p>
<pre><code class="language-bash">/opt/payara-172/glassfish/bin/asadmin --port 6048 delete-jvm-options -Xmx512m
/opt/payara-172/glassfish/bin/asadmin --port 6048 delete-jvm-options -Xmx1024m
/opt/payara-172/glassfish/bin/asadmin --port 6048 create-jvm-options -Xmx2048m
</code></pre>
<p>Alternative: You can edit the settings directly in the domain.xml in the config directory of the SORMAS domain. Just search for <code>Xmx</code> - there should be two entries that need to be changed.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/sormas-foundation/SORMAS-Project" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["tabs"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": 0.1}</script>
    
    
      <script src="../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>